$(document).ready(function(){
    $('#question-activity button:first').click(function(){
        $.ajax(
            $(this).attr('-data-upvote-url'),
            {
                type: 'PUT',
                success: function(data, textStatus, xhr) {
                    console.log(data);
                }
            }
        );
    });
    $("section#answers .answer-activity button:first").each(function(){
        var upvoteUrl = $(this).attr('-data-upvote-url');
        $(this).click(function(){
            $.ajax(
                upvoteUrl,
                {
                    type: 'PUT',
                    success: function(data, textStatus, xhr) {
                        checkUpvotes();
                    }
                }
            );
        });
    });
    checkUpvotes();
});

function checkUpvotes() {
    $('section#answers .answer-activity button:first').each(function(){
        var votesArea = $(this).next('span.votes');
        var upvoteButton = $(this);
        $.getJSON($(this).attr('-data-votes-url'), function(data){
            votesArea.html(data['votes']);
            if (data['upvoted']) {
                upvoteButton.addClass('upvoted');
            }
        });
    });
}
